---
- name: Pull facts on target_server {{ target_server }}
  action: setup
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"

- name: List the Virtual Machines on {{ target_server }}
  virt: command=list_vms
  register: virt_vms
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"

#TODO
#Update following task to account for clustered VSDs
- name: Check if {{ vsd_fqdn }} is running on {{ target_server }}
  fail: msg="The VM {{ vsd_fqdn }} is not running on this target_server."
  when: vsd_fqdn not in virt_vms.list_vms and vsd_sa_or_ha == "sa"

- name: Check if {{ inventory_hostname }} is running on {{ target_server }}
  fail: msg="The VM {{ inventory_hostname }} is not running on this target_server."
  when: inventory_hostname not in virt_vms.list_vms

