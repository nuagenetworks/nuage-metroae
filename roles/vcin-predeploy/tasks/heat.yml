---
# TODO:
# Check for existing stack or vms

- name: Get the public key for the current user
  local_action: command cat "{{ user_ssh_pub_key }}"
  register: current_user_ssh_key

- name: Creating VCIN stack
  register: create_stack
  os_stack:
    name: "{{ inventory_hostname }}"
    template: "roles/vcin-predeploy/files/vcin.yml" 
    auth:
      "{{ os_auth }}"
    parameters:
      vm_name: "{{inventory_hostname}}"
      vcin_image: "{{ vcin_image }}"
      vcin_flavor: "{{ vcin_flavor }}"
      vcin_net: "{{ vcin_network }}"
      ssh_key: "{{ current_user_ssh_key.stdout }}"
  delegate_to: 127.0.0.1
- debug: var=create_stack['stack']['outputs'][0]['output_value']
