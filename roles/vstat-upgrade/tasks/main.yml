- name: Enable vstat upgrade
  assert:
    that: vstat_upgrade_enabled|default(False)
    msg: Elastisearch upgrade is still in testing phase. Hence not supported

- name: Shutdown/Destroy Current vstat node(s)
  include_role: 
    name: vstat-destroy
  vars:
    preserve_vstat: True

- name: Deploy VSD nodes with new version
  include_role:
    name: vstat-predeploy

- name: Wait for VSD ssh to be ready
  local_action:
    module: wait_for
    port: "22"
    host: "{{ mgmt_ip }}"
    search_regex: OpenSSH
    delay: 1

- name: Bring up new VSTAT node(s)
  include_role:
    name: vstat-deploy
