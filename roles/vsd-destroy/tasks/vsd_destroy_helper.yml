---
- name: Destroy VSD VM
  virt:
    name: "{{ inventory_hostname }}"
    state: destroyed
    uri: qemu:///system
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"

- name: Undefine VSD VM
  virt:
    name: "{{ inventory_hostname }}"
    command: undefine
    uri: qemu:///system
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"

- name: Destroy the images directory
  file:
    path: "{{ images_path }}/{{ inventory_hostname }}"
    state: absent
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"

