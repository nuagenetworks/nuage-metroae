---
- block:

  - include: kvm.yml
    when: target_server_type | match("kvm")
    tags:
      - vsd
      - vsd-destroy

  - include: heat.yml
    when: target_server_type | match("heat")
    tags:
      - vsd
      - heat
      - vsd-destroy

  - include: vcenter.yml
    when: target_server_type | match("vcenter")
    tags:
      - vsd
      - vsd-destroy

  when: (not destroy_upgrade_vm | default( False )) or upgrade_vmname is defined
