- block:
  - name: Query Target Server facts
    action: setup
  
  - name: Include OS-specific variables.
    include_vars: "{{ ansible_os_family }}.yml"
 
  - name: Create libvirt image directory
    file: path={{ images_path }}/{{ upgrade_vmname | default(vmname) }}
          state=directory
          owner={{ libvirt.user }}
          group={{ libvirt.group }}
  
  - name: Copy the VM qcow2 image to virt images diectory
    copy: src={{ qcow2_path }}/{{ qcow2_file_name }}
          dest={{ images_path }}/{{ upgrade_vmname | default(vmname) }}/{{ dest_filename | default(qcow2_file_name) }}
          owner={{ libvirt.user }}
          group={{ libvirt.group }}
        
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"
