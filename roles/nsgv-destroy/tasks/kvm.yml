---
- name: List the Virtual Machines on {{ target_server }}
  virt: command=list_vms
  register: virt_vms
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"

- include: nsgv_destroy_helper.yml
  when: vmname | default(inventory_hostname) in virt_vms.list_vms

- name: Destroy the images directory
  file: path={{ images_path }}/{{ inventory_hostname }}
        state=absent
  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"
