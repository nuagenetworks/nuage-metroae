---

- include_role:
    name: check-node-reachability

- name: Get VSD directory stat
  stat:
    path: /opt/vsd
  remote_user: root
  register: vsd_dir
  when: node_reachable

- name: Set fact for VSD present
  set_fact:
    vsd_present: "{{ vsd_dir is defined and
                     vsd_dir.stat is defined and
                     vsd_dir.stat.isdir is defined and
                     vsd_dir.stat.isdir }}"

- include: kvm.yml
  when: target_server_type | match("kvm")
  tags:
    - vsd
    - vsd-predeploy

- include: heat.yml
  when: target_server_type | match("heat")
  tags:
    - vsd
    - heat
    - vsd-predeploy

- include: vcenter.yml
  when: target_server_type | match("vcenter")
  tags:
    - vsd
    - vsd-predeploy
