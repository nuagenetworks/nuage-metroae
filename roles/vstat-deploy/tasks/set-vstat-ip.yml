- block:
  - name: Get VSTAT details from OpenStack
    os_server_facts:
      auth:
        "{{ os_auth }}"
      server: "{{ inventory_hostname }}"
    register: vstat
    delegate_to: "{{ ansible_deployment_host }}"

  - name: Set vstat mgmt ip
    set_fact:
      vstat_mgmt_ip: "{{ vstat['ansible_facts']['openstack_servers'][0]['addresses'][mgmt_interface.network][0]['addr'] }}"
  when: dhcp

- name: Set vstat mgmt ip
  set_fact:
    vstat_mgmt_ip: "{{ mgmt_ip }}"
  when: not dhcp
