---
- block:

  - import_tasks: kvm.yml
    when: target_server_type | match("kvm")
    tags:
      - vstat
      - vstat-destroy

  - import_tasks: heat.yml
    when: target_server_type | match("heat")
    tags:
      - vstat
      - heat
      - vstat-destroy

  - import_tasks: vcenter.yml
    when: target_server_type | match("vcenter")
    tags:
      - vstat
      - vstat-destroy
      
  when: upgrade_vmname is defined or (preserve_vm | default( False ))
