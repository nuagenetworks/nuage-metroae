---
- name: Add docker apt key
  remote_user: "{{ target_server_username }}"
  apt_key:
    keyserver: hkp://p80.pool.sks-keyservers.net:80
    id: 58118E89F3A912897C070ADBF76221572C52609D
  when: ansible_os_family == "Debian"

- name: Add docker apt repository
  remote_user: "{{ target_server_username }}"
  apt_repository:
    repo: deb https://apt.dockerproject.org/repo ubuntu-{{ ansible_distribution_release }} main
  when: ansible_os_family == "Debian"

- name: Install Docker for Debian OS family distros
  remote_user: "{{ target_server_username }}"
  apt:
    name: docker-engine
    state: present
  when: ansible_os_family == "Debian"

- name: Install Docker for RedHat OS family distros
  remote_user: "{{ target_server_username }}"
  yum:
    name: docker
    state: present
  when: ansible_os_family == "RedHat"

- name: Restart docker service
  remote_user: "{{ target_server_username }}"
  service:
    name: docker
    state: restarted

- name: Execute a yum update for RedHat OS family distros
  remote_user: "{{ target_server_username }}"
  yum:
    name: "*"
    state: latest
  when: ansible_os_family == "RedHat"

- name: Execute an apt-get update for Debian OS family distros
  remote_user: "{{ target_server_username }}"
  apt:
    upgrade: dist
  when: ansible_os_family == "Debian"

- name: Download pip installer
  remote_user: "{{ target_server_username }}"
  command: curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py

- name: Execute pip installer
  remote_user: "{{ target_server_username }}"
  command: python get-pip.py

- name: Intall docker-py
  remote_user: "{{ target_server_username }}"
  pip:
    name: docker-py
