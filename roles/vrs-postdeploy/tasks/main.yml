---
- name: Wait for active VSC ssh to be ready
  local_action:
    module: wait_for
    port: "22"
    host: "{{ active_controller_addr }}"
    search_regex: OpenSSH
    delay: 1

- name: Pull facts on VRS target {{ inventory_hostname }}
  remote_user: "{{ target_server_username }}"
  action: setup

- name: Get ovs-vsctl show output
  command: ovs-vsctl show
  register: ovs_show_result
  remote_user: "{{ target_server_username }}"
  
- name : Check if Active controller is connected
  assert: 
   that : ovs_show_result.stdout  | search ('\"tcp:{{ active_controller_addr }}:6633\"\\n.*role:\smaster\n.*is_connected:\strue')  
   msg: " {{ active_controller_addr }} is not connected"
   
- name : Check if Stand by controller is connected
  assert: 
   that : ovs_show_result.stdout  | search ('\"tcp:{{ standby_controller_addr }}:6633\"\\n.*role:\sslave\n.*is_connected:\strue')  
   msg: " {{ standby_controller_addr }} is not connected"   


