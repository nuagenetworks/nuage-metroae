---

- hosts: localhost
  connection: local
  gather_facts: no
  roles:
    - init

- hosts: servers
  gather_facts: yes
  roles:
    - { role: vm-host, tags: [ 'vsd', 'predeploy', 'vsc' ] }

- hosts: vsds
  gather_facts: no
  tags: [ 'vsd', 'predeploy' ]
  tasks:
    - name: Create VSD VM for {{ id }}
      include_role:
        name: vsd
        tasks_from: create-vm

- hosts: vsds
  serial: 1
  gather_facts: no
  roles:
    - { role: vsd, tags: [ 'vsd', 'install' ] }

- hosts: vscs
  gather_facts: no
  roles:
    - { role: vsc, tags: [ 'vsc', 'install' ] }
