---

- hosts: localhost
  connection: local
  gather_facts: no
  roles:
    - init

- hosts: vsds
  serial: 1   # Serialize to avoid RACE conditions on libvirt
  gather_facts: no
  roles:
    - { role: destroy-vm, tags: vsd }

- hosts: vscs
  serial: 1   # Serialize to avoid RACE conditions on libvirt
  gather_facts: no
  roles:
    - { role: destroy-vm, tags: vsc }

- hosts: ess
  serial: 1   # Serialize to avoid RACE conditions on libvirt
  gather_facts: no
  roles:
    - { role: destroy-vm, tags: es }

- hosts: proxy
  gather_facts: no
  roles:
    - { role: destroy-vm, tags: proxy }

- hosts: nsgs
  serial: 1   # Serialize to avoid RACE conditions on libvirt
  gather_facts: no
  roles:
    - { role: destroy-vm, tags: nsg }
