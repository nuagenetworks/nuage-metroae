---

- block:

  - name: Store Nuage variables in hostvars for localhost, allow '//' for comments
    set_fact:
      nuage: "{{ lookup('file','nuage.json') | regex_replace( '[^:]//(.*)' ) | from_json }}"

  - name: Store default VMWare Datastore
    set_fact:
      vmware_ds: "{{ ( nuage.vcenter is defined ) | ternary( nuage.vcenter.datastore | default(''), '' ) }}"
  tags: always

- name: Process VSD hosts
  include_tasks: add-hosts.yml
  vars:
    vm_role: 'vsd'
    vms: "{{ nuage.vsds }}"
    vm_hostname: "{{ vsd_cluster|ternary( 'vsd%1d', 'vsd' ) }}"
    group: "vsds"
  tags: vsd
  
- name: Process VSC hosts
  include_tasks: add-hosts.yml
  vars:
    vm_role: 'vsc'
    vms: "{{ nuage.vscs }}"
    vm_hostname: 'vsc%02d'
    ansible_user: "admin"
    group: "vscs"
  tags: vsc

- name: Process ES hosts
  include_tasks: add-hosts.yml
  vars:
    vm_role: 'es'
    vms: "{{ nuage.stats }}"
    vm_hostname: 'es%1d'
    group: "ess"
  tags: es
