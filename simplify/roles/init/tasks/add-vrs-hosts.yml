---
- debug: var=vrs_group

- name: Iterate over VRS hosts, add to 'servers' by IP address
  add_host: 
    name: "{{ item.1 }}"
    id: "{{ name | format( item.0 ) }}"
    groups: servers, vrs
    on_vmware: "{{ vrs_group.1.on_vmware | default(false) }}"
    ansible_user: "{{ vrs_group.1.ansible_user | default( nuage.ansible_user | default('root') ) }}"
    nuage: "{{ nuage }}"
    primary_vsc: "{{ hostvars[groups['vscs'][ vrs_group.1.primary_vsc ]].control_ip }}"
    secondary_vsc: "{{ (vrs_group.1.secondary_vsc is defined) | ternary( hostvars[groups['vscs'][ vrs_group.1.secondary_vsc ]].control_ip, '0.0.0.0' ) }}"
  with_indexed_items: "{{ vrs_group.1.hosts }}"

# TODO for VRS on ESXi, call VCIN API to add config using nuagee_vspk module 
