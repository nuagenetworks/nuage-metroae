---

- name: Check for valid VSD configuration
  assert:
    that: (nuage.vsds | length == 1) or (nuage.vsds | length == 3)
    msg:  "A VSD config must consist of either 1 or 3 nodes"

- name: Check for VSD standalone or cluster
  set_fact:
    vsd_cluster: "{{ nuage.vsds | length == 3}}"

- name: Find name of VSD QCOW2 File
  find: path="{{ nuage.unzipped_files_dir }}/vsd/qcow2"  pattern="*.qcow2" recurse=yes
  register: rc_vsd_file

- debug: var=rc_vsd_file verbosity=1

- name: Verify that a VSD QCOW2 file was found
  assert: {
    that: "{{ rc_vsd_file.matched }} > 0",
    msg: "Unable to find VSD VM image file"
  }

- name: Register VSD QCOW2 variables with proper path and image locations for use in other playbooks
  set_fact:
    vsd_qcow2_path: "{{ rc_vsd_file.files[0].path | dirname }}"
    vsd_qcow2_file_name: "{{ rc_vsd_file.files[0].path | basename }}"
