---
- name: Get VSD nodes network and monit information prior to upgrade
  hosts: vsds
  any_errors_fatal: true
  vars:
    report_filename: vsd_pre_upgrade_report.txt
  roles:
    - vsd-health

- name: Decouple VSD node1 and node3
  include: vsd_decluster.yml

- name: Upgrade VSD Node1 and Node3
  hosts: vsd_ha_node1:vsd_ha_node3
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsd-upgrade

- name: Get VSC nodes inofrmation prior to upgrade 
  include: vsc_health.yml 

- name: Backup VSC node1
  hosts: vsc_ha_node1
  gather_facts: no
  any_errors_fatal: true
  roles:
   - vsc-backup

- name: Upgrade VSC node1
  hosts: vsc_ha_node1:vsd_ha_node1:vsd_ha_node3
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsc-upgrade

- name: Gather network and monit information of new VSD node1 and node3 after enabling VSD api
  hosts: vsd_ha_node1:vsd_ha_node3
  any_errors_fatal: true
  vars:
    report_filename: vsd_post_upgrade_report.txt
  roles:
    - vsd-health

- name: Upgrade VSC node2
  hosts: vsc_ha_node2
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsc-upgrade

- name: Upgrade VSD node2
  hosts: vsd_ha_node2
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsd-upgrade 

- name: Gather network and monit information of all VSD's post upgrade
  hosts: vsds
  any_errors_fatal: true
  vars:
    report_filename: vsd_post_upgrade_report.txt
  roles:
    - vsd-health
