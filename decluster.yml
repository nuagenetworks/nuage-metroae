---
- hosts: localhost
  vars:
    report_filename: ./vsd_decluster_report.txt

  tasks:
  - name: Clean up tmp files from previous runs
    file: path="{{ report_filename }}" state=absent
  - name: Write title to report file
    nuage_append: filename="{{ report_filename }}" text="VSD Decluster Report Start\n"
  - name: Write date to report file
    nuage_append: filename="{{ report_filename }}" text="{{ ansible_date_time.date }}@{{ ansible_date_time.time }}\n"
  - name: Write seperator to report file
    nuage_append: filename="{{ report_filename }}" text="================================================================================\n"

- include: db_backup.yml
- include: decouple.yml report_filename=./vsd_decluster_report.txt
- include: stop_vsd_services.yml 

- hosts: localhost
  vars:
    report_filename: ./vsd_decluster_report.txt
  tasks:
  - name: Write seperator to report file
    nuage_append: filename="{{ report_filename }}" text="================================================================================\n"
  - name: Write out footer
    nuage_append: filename="{{ report_filename }}" text="VSD Decluster Report End\n"
