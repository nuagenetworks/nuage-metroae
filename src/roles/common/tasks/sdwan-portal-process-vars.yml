---
- name: Find name of SD-WAN Portal OS QCOW2 File
  find: path="{{ nuage_unzipped_files_dir }}/vns/portal"  pattern="CentOS-7-x86_64-*.qcow2" recurse=yes
  register: rc_portal_os_file

- debug: var=rc_portal_os_file verbosity=1

- name: Register SD-WAN Portal OS QCOW2 variables with proper path and image locations for use in other playbooks
  set_fact:
    qcow2_path: "{{ rc_portal_os_file.files[0].path | dirname }}"
    qcow2_file_name: "{{ rc_portal_os_file.files[0].path | basename }}"
  when: rc_portal_os_file.matched > 0


- name: Find Portal SW package location
  find: path="{{ nuage_unzipped_files_dir }}/vns/portal" pattern="nuage-portal-container*" recurse=yes
  register: rc_portal_file
  
- debug: var=rc_portal_file verbosity=1

- name: Register SD-WAN PORTAL variable with proper path and image locations for use in other playbooks
  set_fact:
    portal_path: "{{ rc_portal_file.files[0].path | dirname }}"
    portal_file_name: "{{ rc_portal_file.files[0].path | basename }}"
  when: "{{ rc_portal_file.matched }} > 0"

- name: Set portal_check
  set_fact: portal_check={{portals is defined}}

- name: Assign empty list to myportals if it is undefined
  set_fact: portals= default([])
  when: not portal_check

- name: Create host_vars files for sdwan portal
  template: src=sdwan_portal.j2 backup=no dest={{ inventory_dir }}/host_vars/{{ item.hostname }}
  with_items: "{{ portals }}"
  when: portal_check

