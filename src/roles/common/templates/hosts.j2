# *** WARNING ***
# This file is automatically generated by build.yml.
# Changes made to this file may be overwritten.
#
localhost ansible_connection=local

{% if vsds is defined and vsds|length > 0 %}

{% if vsds|length == 1 %}

[vsd_sa_node]
{{ vsds[0].hostname }}

{% if not inplace %}
[vsd_upgrade_sa_node:children]
vsd_sa_node
{% endif %}

{% else %}

[vsd_ha_node1]
{{ vsds[0].hostname }}
[vsd_ha_node2]
{{ vsds[1].hostname }}
[vsd_ha_node3]
{{ vsds[2].hostname }}

{% if not inplace %}
[vsd_upgrade_ha_node1:children]
vsd_ha_node1
[vsd_upgrade_ha_node2:children]
vsd_ha_node2
[vsd_upgrade_ha_node3:children]
vsd_ha_node3
{% endif %}

{% if vsds|length == 6 %}
[vsd_standby_node1]
{{ vsds[3].hostname }}
[vsd_standby_node2]
{{ vsds[4].hostname }}
[vsd_standby_node3]
{{ vsds[5].hostname }}

{% if not inplace %}
[vsd_upgrade_standby_node1:children]
vsd_standby_node1
[vsd_upgrade_standby_node2:children]
vsd_standby_node2
[vsd_upgrade_standby_node3:children]
vsd_standby_node3
{% endif %}

{% endif %}

{% endif %}

{% if inplace %}
[vsd_inplace_upgrade_nodes]
{% for vsd in vsds %}
{{ vsd.hostname }}
{% endfor %}
{% endif %}

[primary_vsds:children]
{% if vsds|length == 1 %}
vsd_sa_node
{% else %}
vsd_ha_node1
vsd_ha_node2
vsd_ha_node3
{% endif %}

[primary_upgrade_vsds:children]
{% if not inplace %}
{% if vsds|length == 1 %}
vsd_upgrade_sa_node
{% else %}
vsd_upgrade_ha_node1
vsd_upgrade_ha_node2
vsd_upgrade_ha_node3
{% endif %}
{% else %}
vsd_inplace_upgrade_nodes
{% endif %}

{% if vsds|length == 6 %}
[standby_vsds:children]
vsd_standby_node1
vsd_standby_node2
vsd_standby_node3
{% if not inplace %}
[standby_upgrade_vsds:children]
vsd_upgrade_standby_node1
vsd_upgrade_standby_node2
vsd_upgrade_standby_node3
{% endif %}
{% endif %}

[vsds:children]
primary_vsds
{% if vsds|length == 6 %}
standby_vsds
{% endif %}

{% endif %}

{% if vcins is defined and vcins|length > 0 %}

[vcin_masters]
{% for vcin in vcins %}
{% if 'master_vcin' not in vcin %}
{{ vcin.hostname }}

{% endif %}
{% endfor %}

[vcin_slaves]
{% for vcin in vcins %}
{% if 'master_vcin' in vcin %}
{{ vcin.hostname }}

{% endif %}
{% endfor %}

[vcins:children]
vcin_masters
vcin_slaves

{% endif %}

{% if vscs is defined and vscs|length > 0 %}

{% if vscs|length == 1 or upgrade.force_vsc_standalone_upgrade | default(false) %}
[vsc_sa_node]
{% for vsc in vscs %}
{{ vsc.hostname }}
{% endfor %}
[vscs:children]
vsc_sa_node
{% endif %}

{% if vscs|length > 1 and not upgrade.force_vsc_standalone_upgrade | default(false) %}
[vsc_ha_node1]
{% for vsc in vscs %}
{% if loop.index % 2 == 1 %}
{{ vsc.hostname }}
{% endif %}
{% endfor %}

[vsc_ha_node2]
{% for vsc in vscs %}
{% if loop.index % 2 == 0 %}
{{ vsc.hostname }}
{% endif %}
{% endfor %}

[vscs:children]
vsc_ha_node1
vsc_ha_node2

{% endif %}

{% endif %}

{% if dnss is defined and dnss|length > 0 %}
[dnss]
{% for dns in dnss %}
{{ dns.hostname }}
{% endfor %}
{% endif %}

{% if gvms is defined and gvms|length > 0 %}
[gvms]
{% for gvm in gvms %}
{{ gvm.hostname }}
{% endfor %}
{% endif %}

{% if vnsutils is defined and vnsutils|length > 0 %}
[vnsutils]
{% for vnsutil in vnsutils %}
{{ vnsutil.hostname }}

{% endfor %}
{% endif %}

{% if nuhs is defined and nuhs|length > 0 %}
[nuhs]
{% for nuh in nuhs %}
{{ nuh.hostname }}
{% endfor %}

{% endif %}

{% if nsgvs is defined and nsgvs|length > 0 %}
[nsgvs]
{% for nsgv in nsgvs %}
{{ nsgv.vmname }}
{% endfor %}
{% endif %}

{% if vstats is defined and vstats|length > 0 %}

{% for vstat in vstats %}
[vstat_node{{ loop.index }}]
{{ vstat.hostname }}
{% endfor %}

{% if vstats|length == 6 %}
[primary_vstats:children]
{% for i in range(1, 4)%}
vstat_node{{ i }}
{% endfor %}

[backup_vstats:children]
{% for i in range(4, 7)%}
vstat_node{{ i }}
{% endfor %}

{% else %}
[vstats:children]
{% for vstat in vstats %}
vstat_node{{ loop.index }}
{% endfor %}
{% endif %}
{% endif %}

{% if vrss is defined and vrss|length > 0 %}
[vrss]
{% for vrs_dict_list in vrss %}
{% for vrs_dict in vrs_dict_list['vrs_ip_list'] %}
{{ vrs_dict }}
{% endfor %}
{% endfor %}
{% endif %}

{% if vsrs is defined and vsrs|length > 0 %}
[vsrs]
{% for vsr in vsrs %}
{{ vsr.hostname }}
{% endfor %}
{% endif %}

{% if stcvs is defined and stcvs|length > 0 %}
[stcvs]
{% for stcv in stcvs %}
{{ stcv.hostname }}
{% endfor %}
{% endif %}

{% if vrss is defined and vrss|length > 0 %}
[vrss]
{% for vrs_dict_list in vrss %}
{% for vrs_dict in vrs_dict_list['vrs_ip_list'] %}
{{ vrs_dict }} avrs={{ 'avrs' in vrs_dict_list and vrs_dict_list['avrs'] }}
{% endfor %}
{% endfor %}
{% endif %}

{% if portals is defined and portals|length > 0 %}

{% if portals|length == 1 %}
[portal_sa_node]
{{ portals[0].hostname }} {% if 'mgmt_bridge' in portals[0] %} mgmt_bridge={{ portals[0].mgmt_bridge }}{% endif %}

[portals:children]
portal_sa_node

{% else %}

[portal_ha_node1]
{{ portals[0].hostname }} {% if 'mgmt_bridge' in portals[0] %} mgmt_bridge={{ portals[0].mgmt_bridge }}{% endif %}

[portal_ha_node2]
{{ portals[1].hostname }} {% if 'mgmt_bridge' in portals[1] %} mgmt_bridge={{ portals[1].mgmt_bridge }}{% endif %}

[portal_ha_node3]
{{ portals[2].hostname }} {% if 'mgmt_bridge' in portals[2] %} mgmt_bridge={{ portals[2].mgmt_bridge }}{% endif %}

[portals:children]
portal_ha_node1
portal_ha_node2
portal_ha_node3

{% endif %}

{% endif %}

[all:vars]
{% if ssh_proxy_host is defined %}
ansible_ssh_common_args='-o ProxyCommand="ssh -W %h:%p -q {{ ssh_proxy_username | default("root") }}@{{ ssh_proxy_host }}"'
{% endif %}
